<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />

    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  </head>
  <body>
    <div class="relative flex size-full min-h-screen flex-col bg-[#fcf8f8] group/design-root overflow-x-hidden" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
      <div class="layout-container flex h-full grow flex-col">
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f3e7e8] px-10 py-3">
          <div class="flex items-center gap-4 text-[#1b0e0e]">
            <div class="size-4">
              <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_6_330)">
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M24 0.757355L47.2426 24L24 47.2426L0.757355 24L24 0.757355ZM21 35.7574V12.2426L9.24264 24L21 35.7574Z"
                    fill="currentColor"
                  ></path>
                </g>
                <defs>
                  <clipPath id="clip0_6_330"><rect width="48" height="48" fill="white"></rect></clipPath>
                </defs>
              </svg>
            </div>
            <h2 class="text-[#1b0e0e] text-lg font-bold leading-tight tracking-[-0.015em]">Streetwear Co.</h2>
          </div>
          <div class="flex flex-1 justify-end gap-8">
            <div class="flex items-center gap-9">
              <a class="text-[#1b0e0e] text-sm font-medium leading-normal" href="#">Home</a>
              <a class="text-[#1b0e0e] text-sm font-medium leading-normal" href="#">Shop</a>
              <a class="text-[#1b0e0e] text-sm font-medium leading-normal" href="#">About</a>
              <a class="text-[#1b0e0e] text-sm font-medium leading-normal" href="#">Contact</a>
            </div>
            <button
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#f3e7e8] text-[#1b0e0e] text-sm font-bold leading-normal tracking-[0.015em]"
            >
              <span class="truncate">Cart (2)</span>
            </button>
            <div
              class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuBsWepNb6ELRDcjWcap4kMdZVe7JDzfaCNLxfv5x45mlZqSrgJlOzVBG-cx23_5x395NYeZxGaqg1OOVJk8ScMXUU5_4KsggWDATFlurIhvn-Jmpek9dkFrZn-pBAUNJ597HOoMlOxK1vBA3fNo2fNbGqgpssjpPVtA4uy5pDi1XLjalnQv0_WC7X3rbvUCTcGxydNE8mAHovF7OgN7ycHP3FfjKAeOYp92ZMljyIzWVH6LAGw00C5RP80XchIfrz5KU2t8WgkTtANS");'
            ></div>
          </div>
        </header>
        <div class="px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="flex flex-wrap justify-between gap-3 p-4"><p class="text-[#1b0e0e] tracking-light text-[32px] font-bold leading-tight min-w-72">Your Cart</p></div>
            <div class="flex gap-4 bg-[#fcf8f8] px-4 py-3 justify-between">
              <div class="flex items-start gap-4">
                <div
                  class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-[70px]"
                  style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAuBJECdju-2nAgBeCgCrRty9UdM4Bsy0-OnuOXK8qaSK5C8XN_63PXTZ7ABzlaeyzI6bpUGljQaNlfoVVUr_gAaOYEcwo-jvwp7jOvz98_nD4dCqaTGb_uQUsnUu3z6kXPLa81gfR3jsy7MgnhdZOyY-C157iRe6sdfnC8mDzaIGO1hHZKu95LSmiqJ5ZPEml-lbNzVIdB_QJiUnrpkc3Q0zU0RnA_SbBG1esxeEjDIz8rffY-U5Bzj-Bcc1FhuT3aYz_Ws30iSD5J");'
                ></div>
                <div class="flex flex-1 flex-col justify-center">
                  <p class="text-[#1b0e0e] text-base font-medium leading-normal">Classic Tee - White</p>
                  <p class="text-[#994d51] text-sm font-normal leading-normal">$45.00</p>
                  <p class="text-[#994d51] text-sm font-normal leading-normal">Size M</p>
                </div>
              </div>
              <div class="shrink-0">
                <div class="flex items-center gap-2 text-[#1b0e0e]">
                  <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">-</button>
                  <input
                    class="text-base font-medium leading-normal w-4 p-0 text-center bg-transparent focus:outline-0 focus:ring-0 focus:border-none border-none [appearance:textfield] [&amp;::-webkit-inner-spin-button]:appearance-none [&amp;::-webkit-outer-spin-button]:appearance-none"
                    type="number"
                    value="1"
                  />
                  <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">+</button>
                </div>
              </div>
            </div>
            <div class="flex gap-4 bg-[#fcf8f8] px-4 py-3 justify-between">
              <div class="flex items-start gap-4">
                <div
                  class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-[70px]"
                  style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCkKBSwGbj1wS9k6rRtAd5Bw_KLjtigddoPKCGtqBAcqdaFk0LVhD6hjQG8UabbP4PElAzJ13WyZHMvOd7DOqytNAe-KdRvBZq60-xM6h-RqFInG4LZWVXIoX96pJOjUD-g3toBcjJw6EwyqbZUoQmQdwRv2t-vA5U86bBYDpxhnTnQTU30ORxKsjeFjFsb3652yXPrejgfM3ecXc0Jwfb7-lb5xQMC48f2k5QYK5r5QIl2x6XwU1V0GKZoWbsk_NEgN20Dt0UvFp-9");'
                ></div>
                <div class="flex flex-1 flex-col justify-center">
                  <p class="text-[#1b0e0e] text-base font-medium leading-normal">Vintage Denim Jacket</p>
                  <p class="text-[#994d51] text-sm font-normal leading-normal">$60.00</p>
                  <p class="text-[#994d51] text-sm font-normal leading-normal">Size L</p>
                </div>
              </div>
              <div class="shrink-0">
                <div class="flex items-center gap-2 text-[#1b0e0e]">
                  <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">-</button>
                  <input
                    class="text-base font-medium leading-normal w-4 p-0 text-center bg-transparent focus:outline-0 focus:ring-0 focus:border-none border-none [appearance:textfield] [&amp;::-webkit-inner-spin-button]:appearance-none [&amp;::-webkit-outer-spin-button]:appearance-none"
                    type="number"
                    value="1"
                  />
                  <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">+</button>
                </div>
              </div>
            </div>
            <h3 class="text-[#1b0e0e] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Order Summary</h3>
            <div class="p-4">
              <div class="flex justify-between gap-x-6 py-2">
                <p class="text-[#994d51] text-sm font-normal leading-normal">Subtotal</p>
                <p class="text-[#1b0e0e] text-sm font-normal leading-normal text-right">$105.00</p>
              </div>
              <div class="flex justify-between gap-x-6 py-2">
                <p class="text-[#994d51] text-sm font-normal leading-normal">Shipping</p>
                <p class="text-[#1b0e0e] text-sm font-normal leading-normal text-right">Free</p>
              </div>
              <div class="flex justify-between gap-x-6 py-2">
                <p class="text-[#994d51] text-sm font-normal leading-normal">Taxes</p>
                <p class="text-[#1b0e0e] text-sm font-normal leading-normal text-right">Calculated at checkout</p>
              </div>
              <div class="flex justify-between gap-x-6 py-2">
                <p class="text-[#994d51] text-sm font-normal leading-normal">Total</p>
                <p class="text-[#1b0e0e] text-sm font-normal leading-normal text-right">$105.00</p>
              </div>
            </div>
            <div class="flex px-4 py-3 justify-end">
              <button
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-12 px-5 bg-[#e92932] text-[#fcf8f8] text-base font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">Proceed to Checkout</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const cartItemsListContainer = document.querySelector('.layout-content-container > div.flex.flex-col.max-w-\\[960px\\].flex-1');
        const orderSummaryContainer = document.querySelector('h3.text-\\[#1b0e0e\\].text-lg.font-bold + div.p-4');
        
        let subtotalEl, totalEl;

        if (orderSummaryContainer) {
            const summaryRows = orderSummaryContainer.querySelectorAll('div.flex.justify-between');
            summaryRows.forEach(row => {
                const keyEl = row.querySelector('p.text-\\[#994d51\\]');
                const valueEl = row.querySelector('p.text-\\[#1b0e0e\\]');
                if (keyEl && valueEl) {
                    if (keyEl.textContent.trim() === 'Subtotal') subtotalEl = valueEl;
                    else if (keyEl.textContent.trim() === 'Total') totalEl = valueEl;
                }
            });
        }

        function displayMessage(message) {
            // Clear existing items before showing a message
            const existingItems = cartItemsListContainer.querySelectorAll('.cart-item-dynamic');
            existingItems.forEach(item => item.remove());
            
            // Remove existing message if any
            const existingMessage = cartItemsListContainer.querySelector('.cart-message');
            if (existingMessage) existingMessage.remove();

            const messageEl = document.createElement('p');
            messageEl.className = 'text-center text-[#1b0e0e] p-4 cart-message';
            messageEl.textContent = message;
            // Insert after the "Your Cart" title
            const titleEl = cartItemsListContainer.querySelector('div.flex.flex-wrap.justify-between');
            if (titleEl && titleEl.nextSibling) {
                 cartItemsListContainer.insertBefore(messageEl, titleEl.nextSibling);
            } else if (titleEl) {
                 cartItemsListContainer.appendChild(messageEl);
            } else {
                 cartItemsListContainer.prepend(messageEl); // Fallback
            }
        }

        fetch('/cart')
          .then(response => {
            if (response.status === 401) {
              displayMessage('Please log in to view your cart.');
              if (subtotalEl) subtotalEl.textContent = '$0.00';
              if (totalEl) totalEl.textContent = '$0.00';
              throw new Error('Unauthorized'); // Stop further processing
            }
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(cartItems => {
            // Clear existing static/dynamic items
            const existingItems = cartItemsListContainer.querySelectorAll('.cart-item-dynamic, .flex.gap-4.bg-\\[\\#fcf8f8\\].px-4.py-3.justify-between');
            existingItems.forEach(item => item.remove());
            
            const existingMessage = cartItemsListContainer.querySelector('.cart-message');
            if (existingMessage) existingMessage.remove();

            if (!cartItems || cartItems.length === 0) {
              displayMessage('Your cart is empty.');
              if (subtotalEl) subtotalEl.textContent = '$0.00';
              if (totalEl) totalEl.textContent = '$0.00';
              return;
            }

            let currentSubtotal = 0;

            cartItems.forEach(item => {
              const productVariant = item.product_variant;
              // Assuming product_variant has product.name, product.image_url, and its own price
              // This structure might need adjustment based on the actual API response.
              // For now, let's assume 'product_variant.name' and 'product_variant.image_url' and 'product_variant.price' exist.
              // If product details are nested under 'product_variant.product', adjust accordingly.
              const productName = productVariant.name || (productVariant.product ? productVariant.product.name : 'N/A');
              const productImage = productVariant.image_url || (productVariant.product ? productVariant.product.image_url : 'https://via.placeholder.com/70x70.png?text=No+Image');
              const productPrice = typeof productVariant.price === 'number' ? productVariant.price : (productVariant.product && typeof productVariant.product.price === 'number' ? productVariant.product.price : 0);
              const productSize = productVariant.size || 'N/A';

              currentSubtotal += item.quantity * productPrice;

              const itemEl = document.createElement('div');
              itemEl.className = 'flex gap-4 bg-[#fcf8f8] px-4 py-3 justify-between cart-item-dynamic'; // Added cart-item-dynamic class
              itemEl.id = `cart-item-${item.id}`;

              itemEl.innerHTML = `
                <div class="flex items-start gap-4">
                  <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-[70px]" style="background-image: url('${productImage}');"></div>
                  <div class="flex flex-1 flex-col justify-center">
                    <p class="text-[#1b0e0e] text-base font-medium leading-normal">${productName}</p>
                    <p class="text-[#994d51] text-sm font-normal leading-normal">$${productPrice.toFixed(2)}</p>
                    <p class="text-[#994d51] text-sm font-normal leading-normal">Size ${productSize}</p>
                  </div>
                </div>
                <div class="shrink-0">
                  <div class="flex items-center gap-2 text-[#1b0e0e]">
                    <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">-</button>
                    <input class="text-base font-medium leading-normal w-4 p-0 text-center bg-transparent focus:outline-0 focus:ring-0 focus:border-none border-none [appearance:textfield] [&amp;::-webkit-inner-spin-button]:appearance-none [&amp;::-webkit-outer-spin-button]:appearance-none" type="number" value="${item.quantity}" readonly />
                    <button class="text-base font-medium leading-normal flex h-7 w-7 items-center justify-center rounded-full bg-[#f3e7e8] cursor-pointer">+</button>
                  </div>
                </div>
              `;
              // Insert after the "Your Cart" title
              const titleEl = cartItemsListContainer.querySelector('div.flex.flex-wrap.justify-between');
              if (titleEl && titleEl.nextSibling) {
                   cartItemsListContainer.insertBefore(itemEl, titleEl.nextSibling);
              } else if (titleEl) {
                   cartItemsListContainer.appendChild(itemEl);
              } else {
                   cartItemsListContainer.prepend(itemEl); // Fallback
              }
            });

            if (subtotalEl) subtotalEl.textContent = `$${currentSubtotal.toFixed(2)}`;
            if (totalEl) totalEl.textContent = `$${currentSubtotal.toFixed(2)}`; // Assuming shipping is free for now
          })
          .catch(error => {
            if (error.message !== 'Unauthorized') { // Already handled unauthorized
              console.error('Error fetching cart:', error);
              displayMessage('Could not load cart. Please try again later.');
            }
            if (subtotalEl) subtotalEl.textContent = '$0.00';
            if (totalEl) totalEl.textContent = '$0.00';
          });
      });
    </script>
  </body>
</html>
